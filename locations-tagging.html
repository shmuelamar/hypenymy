<link href="https://s3.amazonaws.com/mturk-public/bs30/css/bootstrap.css"
      media="screen" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<style type="text/css">

    #content {
        margin-bottom: 15px;
        padding: 10px 10px;
        font-family: Verdana, Geneva, sans-serif;
        color: #333333;
        font-size: 0.9em;
    }

    .header-toggle {
        color: white;
        font-weight: bold;
        cursor: pointer;
    }

    p {
        padding: 10px;
        margin: 0;
    }

    p.yellow {
        font-size: 2em;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin-bottom: 21px;
    }

    p.yellow span {
        background: orange;
        cursor: pointer;
    }

    p.yellow::selection {
        color: black;
        background: yellow;
    }

    p.yellow::-moz-selection { /* Code for Firefox */
        color: black;
        background: yellow;
    }


    #question-hint {
        display: none;
    }

    .answers-select {
        display: none;
    }

    .x-button {
        color: red;
        background: white;
        border: 1px solid black;
        border-radius: 50%;
        margin: 0 10px;
        cursor: pointer;
        padding: 1px 6px;
    }


    .flex {
        display: flex;
        width: 100%;
    }

    .flex > input {
        width: 100%;
    }

    #skip, #another-question {
        float: right;
    }

    .panel-primary > .panel-heading {
        color: #ffffff;
        background-color: #ca427e;
        border-color: #ea2279;
    }

    .panel-primary {
        border-color: #df2d75;
    }

    .panel-info > .panel-heading {
        color: #ffffff;
        background-color: #7b96e4;
        border-color: #bce8f1;
    }

    .highlight {
        background-color: yellow;
    }

    .radio1 {
        padding-right: 2em;
        padding-left: 1em;
    }


    .panel-body {
        font-size: medium;
    }

    .panel-title {
        font-size: x-large;
    }

    .hypernyms1 span:hover {
        text-decoration: underline;
    }

    #all-answers {
        display: none;
    }

    .highlight-mnli-word {
        font-weight: bold;
        background-color: yellow;
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.0.1/mustache.min.js"></script>

<H1 class="panel-heading" style="padding-left:400px">
    <mark>This HIT does NOT work from Internet Explorer.</mark>
</H1>
<h4 class="panel-heading" style="padding-left:400px">
    (If you are using Internet Explorer browser (IE) please switch to Chrome or
    Firefox)
</h4>

<h2 class="panel-heading" style="padding-left:400px">
    <mark><b>Important!</b> Please read Instructions and Examples before you
        begin
    </mark>
</h2>

<div id="Version 5-1" style="display: none"></div>

<section class="container" id="content">
    <div class="row col-xs-12 col-md-12">
        <!--Version1-->
        <!-- Instructions -->
        <div class="panel panel-primary" id="instructions">
            <div class="panel-heading header-toggle"
                 onmousedown="toggle('inst-collapse1')">
                Instructions (click to collapse / expand)
            </div>

            <div class="panel-body">
                <div id="inst-collapse1" style="display:none">
                    <br><strong><font
                        size="4">Sentence-Relations</font></strong><br/>
                    (If you completed the 10-question training - you can skip
                    this section)
                    <br/>
                    In this task you'll be given two sentences. Assuming
                    the first sentence is true, you'll have to determine if the second sentence
                    is <b>True</b>, <b>False</b> or <b>Neutral</b>: <br/><br/>
                    <b>True</b><br>
                    Assuming sentence (1) is true, sentence (2) is also likely
                    to be true/correct. In other words, (2) can be inferred
                    from sentence (1).<br/>
                    For example:<br>
                    (1) <i>The man lives in the beautiful city of Paris.</i><br/>
                    (2) <i>The man lives in France.</i><br/>
                    <u>Answer</u>: If (1) is true, (2) is also <b>True</b><br/><br/>

                    Another example:<br>
                    (1) <i>The National Football League semifinals are set.</i><br/>
                    (2) <i>The dates for the semifinals have been
                    determined.</i><br/>
                    <u>Answer</u>: If (1) is true, (2) is also <b>True</b><br/><br/>

                    <br><b>False</b><br>
                    Assuming sentence (1) is true, sentence (2) is likely to be
                    false/incorrect. In other words, (2) contradicts sentence
                    (1).<br/>
                    For example:<br>
                    (1) <i>The man lives in the beautiful city of Paris.</i><br/>
                    (2) <i>The man lives in London.</i><br/>
                    <u>Answer</u>: If (1) is true, (2) is probably <b>False</b><br/><br/>

                    ...And another example:<br>
                    (1) <i>We can leave them and let them die, said
                    Thorn.</i><br/>
                    (2) <i>Thorn told us to make sure we save them.</i><br/>
                    <u>Answer</u>: If (1) is true, (2) is probably <b>False</b><br/><br/>

                    <br><b>Neutral</b><br>
                    Assuming sentence (1) is true, sentence (2) might and might
                    not be true/correct. In other words, we don't have enough
                    information
                    to determine if (2) can be inferred from (1) or if it
                    contradicts it.<br/>
                    For example:<br>
                    (1) <i>The man lives in the beautiful country of France.</i><br/>
                    (2) <i>The man lives in Paris.</i><br/>
                    <u>Answer</u>: There is not enough information in (1) to determine
                    if (2) is true or not (<b>Neutral</b>)<br/><br/>

                    Another example:<br>
                    (1) <i>The cathedral in particular is impressive after
                    dark.</i><br/>
                    (2) <i>The cathedral is equally as impressive during the
                    light of day.</i><br/>
                    <u>Answer</u>: There is not enough information to determine
                    if (2) is true or not (<b>Neutral</b>)<br/><br/>

                    See more examples in the Examples section (below).
                    <br/><br/>

                    <br><strong><font size="4">Writing Your Own Sentences</font></strong><br/>
                    At section 2 you'll be asked to write your own sentences using one of the above relation-types (<i>True</i>, <i>Contradiction</i> or <i>Neutral</i>). Please consider the following:
                    <ol>
                        <li><b>The second sentence must always relate to the same scene or event!</b> So when writing a <i>Neutral</i> sentence, do NOT come up with information that is not related to the first sentence.
                            <br/>Here is a <b>bad</b> example for the following first sentence:<br/>
                            <i>(1) We all enjoyed the game very much.</i><br/>
                            even if you want to write a <i>Neutral</i> or <i>Contradiction</i> sentence, do <b>NOT</b> write anything like that:<br/>
                            <i>"it was sunny yesterday."</i><br/>
                        </li>
                        <li>A reminder: the second sentence is considered as <b>False</b> if it is likely to be false assuming the first sentence is true. When writing a <i>False</i> sentence, make sure some specific detail(s)
                            in your sentence contradicts the matching detail(s) of the the first sentence. Don't just come up with too many false details that will make the reader think it's a different event or scene.<br/>
                            For example, for the following first sentence:<br/>
                            <i>(1) Both me and John enjoyed the game on Sunday very much.</i><br/>
                            Good <i>Contradiction</i> sentences may be:
                            <ul>
                                <li>"<i>I hated the game</i>" - ('hated' contradicts 'enjoyed')</li>
                                <li>"<i>We all loved the game on Monday" - ('Monday' contradicts 'Sunday')</i></li>
                            </ul>
                            The following is a BAD <i>Contradiction</i> sentence:<br/>
                            <i>"Bill hated the game on Monday"</i> - There are too many details that are different from (1), and the reader can't know if it even refers to the same scene. In this case, therefore, this sentence would consider Neutral with respect to (1).
                        </li>
                        <li>Within the same HIT - also diversify your sentence-relations. Try using at least one of each type for the 4 sentences you write.</li>
                        <li>Make sure your sentence is quite different from the first one, just like in the examples above (don't just copy it while changing only one word.)</li>
                        <li>Try to be creative with your logic inference. Think of details that are true or not in the first sentence, and use them to create a new sentence. For exapmle:<br/>
                            <i>(1) Both me and John enjoyed the game on Sunday very much.</i><br/>
                            You can write the following <b>True</b> sentences:
                              <ul>
                                <li>"<i>John enjoyed the game</i>" (it's not mandatory to include the fact that the game took place on Sunday)</li>
                                <li>"<i>John attended the game</i>"</li>
                                <li>"<i>A game took place on Sunday</i>"</li>
                            </ul>
                            You can write the following <b>False</b> sentence:
                              <ul>
                                <li>"<i>John hated the game</i>"</li>
                            </ul>
                            You can write the following <b>Neutral</b> sentence:
                              <ul>
                                <li>"<i>I love soccer games.</i>" (We don't know from (1) that it was a soccer game. Could be any other game)</li>
                                <li>"<i>John thought the game was the best one in his life.</i>" (We don't know that from (1))</li>
                            </ul>
                        </li>
                    </ol>


                    <br><strong><font size="4">HIT Process</font></strong><br/>
                    In the HIT contains of 4 sections:<br/>
                    <ol>
                        <li>For a few given pairs of sentences, you'll have to select the correct sentence relation as described above.
                        </li>
                        <li>For a given sentence, assume it's true and write another sentence in your own words, that is True, False, or Neutral (see above) to the given sentence.
                        </li>
                        <li>For a few given pairs of sentences, you'll have to select the correct sentence relation as described above.
                        </li>
                    </ol>
                    (You'll find more detailed instructions at each section)
                    <br/>

                    <br><strong><font size="4">Bonus</font></strong><br/>
                    A special $10 bonus will be granted for a successful finish
                    of 20 HITs in a good quality.
                    <br/><br/><br/>

                    Please feel free to email me if you have any further
                    questions: ohadrozen@gmail.com. Thanks!
                </div>
            </div>
        </div>


        <!--&lt;!&ndash; Examples &ndash;&gt;-->

        <div class="panel panel-info" id="instructions-examples">
            <div class="panel-heading header-toggle"
                 onmousedown="toggle('inst-collapse2')">
                Examples (click to collapse / expand)
            </div>
            <div class="panel-body" style="background: #ddd">
                <div id="inst-collapse2" style="display:none;"><!--  -->
                    <!--- TODO Instructions -->

                    <div class="container" style="width: 100%;">

                        <h2>Section 1</h2>
                        <img src="https://nlp.biu.ac.il/~ohadr/AMT/images/Slide1.JPG"
                             alt="example1" width="100%">
                        <br/><br/>
                        <h2>Section 2</h2>
                        <img src="https://nlp.biu.ac.il/~ohadr/AMT/images/Slide2.JPG"
                             alt="example1" width="100%">
                        <img src="https://nlp.biu.ac.il/~ohadr/AMT/images/Slide3.JPG"
                             alt="example1" width="100%">
                        <br/><br/>
                        <h2>Section 3</h2>
                        <img src="https://nlp.biu.ac.il/~ohadr/AMT/images/Slide4.JPG"
                             alt="example1" width="100%">
                        <img src="https://nlp.biu.ac.il/~ohadr/AMT/images/Slide5.JPG"
                             alt="example1" width="100%">
                        <img src="https://nlp.biu.ac.il/~ohadr/AMT/images/Slide6.JPG"
                             alt="example1" width="100%">
                        <img src="https://nlp.biu.ac.il/~ohadr/AMT/images/Slide7.JPG"
                             alt="example1" width="100%">
                        <br/><br/>
                        <h2>Section 4</h2>
                        <img src="https://nlp.biu.ac.il/~ohadr/AMT/images/Slide8.JPG"
                             alt="example1" width="100%">
                        <br/><br/>
                        <h2>Section 5</h2>
                        <img src="https://nlp.biu.ac.il/~ohadr/AMT/images/Slide9.JPG"
                             alt="example1" width="100%">
                        <ul class="nav nav-tabs" id="examples-header"
                            style="display: inline-block;"></ul>
                        <div class="tab-content" id="examples-content"></div>
                    </div>
                </div>
            </div>
        </div>


        <form id="main-form" action="/action_page.php">

            <!--************************************* 2. Write Hypothesis with Location *****************************************************-->
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading2">
                    <h4 class="panel-title" id="pannel2_title">
                        {{{s2_header_text}}}
                    </h4>
                </div>
                <div id="collapse2" class="panel-collapse collapse"
                     role="tabpanel" aria-labelledby="heading2">
                    <div class="panel-body">
                        <div id="nli5">
                            <span>{{{s2_text1}}}</span>
                            <!---- Original Sentence ---->
                            <br/><br/>
                            <span style="padding-left: 1em; ">1. Read the following sentence:</span>
                            <br/>
                            <span style="font-style: italic; padding-left: 2em; ">(1) {{{s2_premise5}}}</span>
                            <br/><br/>
                            <label for="h-2_1">{{{s2_text2}}}</label>&nbsp;<br/>
                            (If you really can't think of any such sentence, check this box: <input id="impossible-h-2_1" name="nli5_flipped" type="checkbox" onclick="creativeEntailImpossibleFlip()"> )<br/>
                            <p style="float: left; padding-left: 2em; ">(2) </p><textarea class="form-control" cols="85"
                                      id="h-2_1" placeholder=""  style="width:60%"
                                      maxlength="250" name="s2_creative_sentence1"
                                      rows="2" onblur="updateCreative()">{{{s2_hypothesis5}}}</textarea>
                            <br/>
                            <span style="font-weight: bold"> {{{g_tag_validate_text}}} </span>
                            <table border="0" cellpadding="4" cellspacing="0" style="font-family: Verdana, Geneva, sans-serif; font-size:medium;">
                                <tbody>
                                    <tr><td style="padding-left:2em"><input id="s2-nli5-radio1" name="nli5" type="radio" value="entailment" /> {{{g_entail_text}}}</td></tr>
                                    <tr><td style="padding-left:2em"><input id="s2-nli5-radio2" name="nli5" type="radio" value="contradiction" /> {{{g_contra_text}}}</td></tr>
                                    <tr><td style="padding-left:2em"><input id="s2-nli5-radio3" name="nli5" type="radio" value="neutral" /> {{{g_neutral_text}}}</td></tr>
                                </tbody>
                            </table>
                            <br/>
                            <br/>
                        </div>
                        <div id="nli6">
                            <!---- Original Sentence ---->
                            <span style="padding-left: 1em; ">2. Read the following sentence:</span>
                            <br/>
                            <span style="font-style: italic; padding-left: 2em; ">(1) {{{s2_premise6}}}</span>
                            <br/><br/>
                            <label for="h-2_2">{{{s2_text3}}}</label>&nbsp;<br/>
                            <p style="float: left; padding-left: 2em; ">(2) </p><textarea class="form-control" cols="85"
                                      id="h-2_2" placeholder="" style="width:60%"
                                      maxlength="250" name="s2_creative_sentence2"
                                      rows="2" onblur="updateCreative()">{{{s2_hypothesis6}}}</textarea>
                            <br/>
                            <span style="font-weight: bold"> {{{g_tag_validate_text}}} </span>
                            <table border="0" cellpadding="4" cellspacing="0" style="font-family: Verdana, Geneva, sans-serif; font-size:medium;">
                                <tbody>
                                    <tr><td style="padding-left:2em"><input id="s2-nli6-radio1" name="nli6" type="radio" value="entailment" /> {{{g_entail_text}}}</td></tr>
                                    <tr><td style="padding-left:2em"><input id="s2-nli6-radio2" name="nli6" type="radio" value="contradiction" /> {{{g_contra_text}}}</td></tr>
                                    <tr><td style="padding-left:2em"><input id="s2-nli6-radio3" name="nli6" type="radio" value="neutral" /> {{{g_neutral_text}}}</td></tr>
                                </tbody>
                            </table>
                            <br/>
                            <br/>
                        </div>
                    <br/>
                    <input type="button" value="Next"
                           onclick="navigate('collapse2', 'collapse2b', 2)"
                           id="next-2"/>
                    <br/>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="heading2b">
                    <h4 class="panel-title" id="pannel2b_title">
                        {{{s2b_header_text}}}
                    </h4>
                </div>
                <div id="collapse2b" class="panel-collapse collapse"
                     role="tabpanel" aria-labelledby="heading2">
                    <div class="panel-body">
                    <!-- other-location -> Country creative -->
                    <div id="nli7">
                        <div class="clickable" style="font-size: medium; padding-left:2em">
                            (1) <span>{{{s2_premise7}}}</span>
                        </div>
                        <div class="clickable" style="font-size: medium; padding-left:2em">
                            (2) <span id="s2_hypothesis7">{{{s2_hypothesis7}}}</span>
                        </div>
                        <br/>
                        <span style="font-weight: bold"> 3. {{{g_tag_text}}} </span>
                        <table border="0" cellpadding="4" cellspacing="0" style="font-family: Verdana, Geneva, sans-serif; font-size:medium;">
                            <tbody>
                                <tr><td style="padding-left:2em"><input id="s2-nli7-radio1" name="nli7" type="radio" value="entailment" /> {{{g_entail_text}}}</td></tr>
                                <tr><td style="padding-left:2em"><input id="s2-nli7-radio2" name="nli7" type="radio" value="contradiction" /> {{{g_contra_text}}}</td></tr>
                                <tr><td style="padding-left:2em"><input id="s2-nli7-radio3" name="nli7" type="radio" value="neutral" /> {{{g_neutral_text}}}</td></tr>
                            </tbody>
                        </table>
                        <br/><br/>
                    </div>

                    <!-- other-location -> Country creative -->
                    <div id="nli8">
                        <div class="clickable" style="font-size: medium; padding-left:2em">
                            (1) <span>{{{s2_premise8}}}</span>
                        </div>
                        <div class="clickable" style="font-size: medium; padding-left:2em">
                            (2) <span id="s2_hypothesis8">{{{s2_hypothesis8}}}</span>
                        </div>
                        <br/>
                        <span style="font-weight: bold"> 4. {{{g_tag_text}}} </span>
                        <table border="0" cellpadding="4" cellspacing="0" style="font-family: Verdana, Geneva, sans-serif; font-size:medium;">
                            <tbody>
                                <tr><td style="padding-left:2em"><input id="s2-nli8-radio1" name="nli8" type="radio" value="entailment" /> {{{g_entail_text}}}</td></tr>
                                <tr><td style="padding-left:2em"><input id="s2-nli8-radio2" name="nli8" type="radio" value="contradiction" /> {{{g_contra_text}}}</td></tr>
                                <tr><td style="padding-left:2em"><input id="s2-nli8-radio3" name="nli8" type="radio" value="neutral" /> {{{g_neutral_text}}}</td></tr>
                            </tbody>
                        </table>
                        <br/><br/>
                    </div>
                    <br/>
                    <label for="turker_comments">{{{g_turker_comments_text}}}</label>&nbsp;<br/>
                        <textarea class="form-control" cols="85"
                                  id="turker_comments" placeholder="" style="width:60%"
                                  maxlength="250" name="turker_comments"
                                  rows="2"></textarea>
                        <br/>
                    <br/>
                    <input type="button" value="Back"
                           onclick="navigate('collapse2b', 'collapse2', 2)"
                           id="back-2b"/>
                    <input type="button" value="Submit HIT" onclick="submitHITForm()" id="submit-button"/>
                    <br/>
                    </div>
                </div>
            </div>
            <br/>

            <!-- placeholders for values -->
            <input type="hidden" id="form-input-country" name="input_country" value="" />
            <input type="hidden" id="form-input-location" name="input_location" value="" />
            <input type="hidden" id="form-input-other-location" name="input_other_location" value="" />
            <input type="hidden" id="form-input-sentence" name="input_sentence_template" value="" />
            <input type="hidden" id="form-input-section2-label" name="input_section2_label" value="" />
            <input type="hidden" id="form-input-section2-word-type" name="input_section2_word_type" value="" />

        </form>
    </div>
</section>
<script>
    let DEBUG_MODE = true;

    // main input from server
    let COUNTRY;
    let LOCATION;
    let OTHER_LOCATION;
    let SENTENCE;
    let SECTION2_LABEL;
    let SECTION2_WORD_TYPE;
    let INPUT_CAN_BE_ENTAILED;
    let INPUT_START_CHAR;
    let INPUT_END_CHAR;
    let INPUT_ID;

    if (!DEBUG_MODE) {
        COUNTRY = "${country}";
        LOCATION = "${location}";
        OTHER_LOCATION = "${other_location}";
        SENTENCE = "${sentence}";
        SECTION2_LABEL = "${section2_label}";  // Neutral or Contradiction
        SECTION2_WORD_TYPE = "${section2_word_type}";  // Country or Location
        INPUT_CAN_BE_ENTAILED = "${can_be_entailed}";
        INPUT_START_CHAR = "${start_char}";
        INPUT_END_CHAR = "${end_char}";
        INPUT_ID = "";
    }else {
        COUNTRY = "France";
        LOCATION = "Paris";
        OTHER_LOCATION = "London";
        SENTENCE = "Canal tours expose the grandest face of {{{location}}}.";
        SECTION2_LABEL = "Contradiction";  // Neutral or Contradiction
        SECTION2_WORD_TYPE = "Location";  // Country or Location
        INPUT_CAN_BE_ENTAILED = "1";
        INPUT_START_CHAR = "15";
        INPUT_END_CHAR = "17";
        INPUT_ID = "1337_p";
    }

    // metadata input from server - only for output not really used
    let INPUT_METADATA = {
        can_be_entailed: INPUT_CAN_BE_ENTAILED,
        start_char: INPUT_START_CHAR,
        end_char: INPUT_END_CHAR,
        id: INPUT_ID,
    };

    // the main 3 sentences
    let COUNTRY_SENTENCE = renderSentence(SENTENCE, COUNTRY);
    let LOCATION_SENTENCE = renderSentence(SENTENCE, LOCATION);
    let OTHER_LOCATION_SENTENCE = renderSentence(SENTENCE, OTHER_LOCATION);

    // section2 word types
    let SECTION2_IS_FLIP = false;
    let SECTION2_WORD, SECTION2_FORBIDDEN_WORDS, SECTION2_PREMISE_SENTENCE;

    // we randomly select either country or city for the creative sentence.
    // and we forbid to use the other two words by the user.
    if (SECTION2_WORD_TYPE === 'Country') {
        SECTION2_WORD = COUNTRY;
        SECTION2_PREMISE_SENTENCE = LOCATION_SENTENCE;
        SECTION2_FORBIDDEN_WORDS = [LOCATION, OTHER_LOCATION];
    }else{
        SECTION2_WORD = LOCATION;
        SECTION2_PREMISE_SENTENCE = COUNTRY_SENTENCE;
        SECTION2_FORBIDDEN_WORDS = [COUNTRY, OTHER_LOCATION];
    }

    // constant texts and values to render inside the page
    let VALUES = {
        // ***** section1 *****
        s1_header_text: "1. Label Hypothesis",
        s1_text1: "Read the two sentences below:",

        // 1. location -> country
        s1_premise1: LOCATION_SENTENCE,
        s1_hypothesis1: COUNTRY_SENTENCE,

        // 2. other-location -> country
        s1_premise2: OTHER_LOCATION_SENTENCE,
        s1_hypothesis2: COUNTRY_SENTENCE,

        // 3. country -> location
        s1_premise3: COUNTRY_SENTENCE,
        s1_hypothesis3: LOCATION_SENTENCE,

        // 4. country -> other-location
        s1_premise4: COUNTRY_SENTENCE,
        s1_hypothesis4: OTHER_LOCATION_SENTENCE,

        // ***** section2 *****
        s2_header_text: "1. Write Two Sentences",

        // 5. location -> country (creative1) - entailment
        s2_text2: "Assuming (1) is true, write a <u><b><span id='s2_creative1_label'>True</span></b></u> sentence using the word <span class=\"highlight-mnli-word\">" + SECTION2_WORD + "</span> <u>without</u> using the words <span class=\"highlight-mnli-word\">"+ SECTION2_FORBIDDEN_WORDS.join(' or ') + "</span>",
        s2_premise5: SECTION2_PREMISE_SENTENCE,
        s2_hypothesis5: "",  // placeholder

        // 6. location -> country (creative2) - non-entailment
        s2_text3: "Assuming (1) is true, write a <u><b>" + SECTION2_LABEL + "</b></u> sentence using the word <span class=\"highlight-mnli-word\">" + SECTION2_WORD + "</span> and <u>without</u> using the words <span class=\"highlight-mnli-word\">"+ SECTION2_FORBIDDEN_WORDS.join(' or ') + "</span>",
        s2_premise6: SECTION2_PREMISE_SENTENCE,
        s2_hypothesis6: "",  // placeholder

        // ***** section2b *****
        s2b_header_text: "2. Label Your Sentences",

        // 7. other-location -> country (creative1)
        s2_premise7: OTHER_LOCATION_SENTENCE,
        s2_hypothesis7: "",  // placeholder

        // 8. other-location -> country (creative2)
        s2_premise8: OTHER_LOCATION_SENTENCE,
        s2_hypothesis8: "",  // placeholder

        //globals
        g_tag_text: "Assuming (1) is true, sentence (2) is likely to be:",
        g_tag_validate_text: "Just to be sure, please read carefully the two sentences again. Assuming (1) is true, sentence (2) is likely to be:",
        g_entail_text: "Using only this description and what you know about the world, write a sentence that is definitely <b>correct</b> about the situation or event in the sentence",
        g_contra_text: "Using only this description and what you know about the world, write a sentence that is definitely <b>incorrect</b> about the situation or event in the sentence",
        g_neutral_text: "Using only this description and what you know about the world, write a sentence that <b>might be correct</b> about the situation or event in the sentence, but we can't tell for sure",
        g_turker_comments_text: "Do you have any more comments or suggestions about the task?",
    };

    function toggle(elementId) {
        const current = document.getElementById(elementId).style.display;
        document.getElementById(elementId).style.display = current === 'none' ? 'block' : 'none';
    }

    function renderSentence(sent, location) {
        return Mustache.render(sent, {location: '<span class="highlight-mnli-word">'+location+"</span>"});
    }

    function navigate(collapse, open, section) {
        if(!validateForm(section) && !DEBUG_MODE) {
            return;
        }

        $(document.getElementById(collapse)).collapse('hide');
        $(document.getElementById(open)).collapse('show');
    }

    function updateCreative() {
        const sentCreative1 = document.getElementById("h-2_1").value;
        const sentCreative2 = document.getElementById("h-2_2").value;

        const sent1Highlight = highlight(sentCreative1, COUNTRY);
        const sent2Highlight = highlight(sentCreative2, COUNTRY);

        document.getElementById('s2_hypothesis7').innerHTML = sent1Highlight;
        document.getElementById('s2_hypothesis8').innerHTML = sent2Highlight;
    }

    function creativeEntailImpossibleFlip() {
        let isChecked = document.getElementById('impossible-h-2_1').checked;

        SECTION2_IS_FLIP = !SECTION2_IS_FLIP;

        let newLabel;
        if (isChecked) {
            if(SECTION2_LABEL === 'Contradiction'){
                newLabel = 'Neutral';
            }else{
                newLabel = 'Contradiction';
            }
        }else{
            newLabel = 'True';
        }

        document.getElementById('s2_creative1_label').innerText = newLabel;

        alert("Ok. If you can't think of anything, please write a "+ newLabel + " sentence instead");
    }

    function highlight(text, word) {
        let reg = new RegExp("\\b" + word + "\\b", 'i');

        if (text.match(reg)) {index = text.match(reg).index} else {index = -1}

        if (index >= 0) {
            return text.substring(0, index) + '<span class="highlight-mnli-word">' + text.substring(index, index + word.length) + "</span>" + text.substring(index + word.length);
        }

        console.log("the word " + word + " was not found on: " + text);
        return text;
    }

    function render() {
        console.log("rendering");
        let form = document.querySelector("form");
        let template = form.innerHTML;
        form.innerHTML = Mustache.render(template, VALUES);
    }

    function validateMNLIRadioChecked(nliId){
        return $('input[name="nli' + nliId + '"]:checked').length === 1;
    }


    function validateForm(section) {
        // 1. validate all labels (Entail/Contra/Neutral) checked
        let startNLI = 5; // first 4 are removed

        let errors_msg = [];

        let checkNLI;

        if (section === 1){
            checkNLI = 4;
        }
        else if (section === 2){
            checkNLI = 6;
        }
        else {
            checkNLI = 8;
        }

        for (let i = startNLI; i <= checkNLI; i++) {
            if (!validateMNLIRadioChecked(i)) {
                errors_msg.push('please choose the correct label for sentence number ' + (i - startNLI + 1));
            }
        }

        if (section >= 2) {
            // 2. validate labels of creative section
            let s2Sentence1RadioId;
            let s2Sentence1RequiredLabel;

            if(SECTION2_IS_FLIP) {
                if(SECTION2_LABEL === 'Neutral') {
                    s2Sentence1RadioId = 2;
                    s2Sentence1RequiredLabel = 'Contradiction';
                }else {
                    s2Sentence1RadioId = 3;
                    s2Sentence1RequiredLabel = 'Neutral';
                }
            }else{
                s2Sentence1RadioId = 1;
                s2Sentence1RequiredLabel = 'True';
            }
            if(!document.getElementById('s2-nli5-radio' + s2Sentence1RadioId.toString()).checked) {
                errors_msg.push('please write a ' + s2Sentence1RequiredLabel + ' sentence for sentence number 1');
            }

            if(SECTION2_LABEL === 'Neutral') {
                if (!document.getElementById('s2-nli6-radio3').checked) {
                    errors_msg.push('please write a neutral sentence for sentence number 2');
                }
            }else{  // Contradiction
                if (!document.getElementById('s2-nli6-radio2').checked) {
                    errors_msg.push('please write a contradiction sentence for sentence number 2');
                }
            }

            // 3. validate sentences of creative section contains country
            const reg = new RegExp("\\b" + SECTION2_WORD + "\\b", 'i');
            const sentCreative1 = document.getElementById("h-2_1").value;
            const sentCreative2 = document.getElementById("h-2_2").value;

            if (!sentCreative1.match(reg)) {
                errors_msg.push('please use the word "' + COUNTRY +'" in sentence number 1');
            }

            if (!sentCreative2.match(reg)) {
                errors_msg.push('please use the word "' + COUNTRY +'" in sentence number 2');
            }

            // 4. validate sentences of creative section does not contains location or other-location
            for (let i = 0; i < 2; i++) {
                let word = SECTION2_FORBIDDEN_WORDS[i];
                const wordReg = new RegExp("\\b" + word + "\\b", 'i');

                if (sentCreative1.match(wordReg)) {
                    errors_msg.push('please do not use the word "' + word + '" on sentence number 1');
                }

                if (sentCreative2.match(wordReg)) {
                    errors_msg.push('please do not use the word "' + word + '" on sentence number 2');
                }
            }

            // 5. validate sentences differ
            if (sentCreative1 === sentCreative2) {
                errors_msg.push('please write two different sentences on 1 and 2')
            }
        }

        if (errors_msg.length > 0) {
            alert('please fix the following:\r\n' + errors_msg.join('\r\n'));
            return false;
        }
        return true;
    }

    function submitHITForm() {
        if(!validateForm(3) && !DEBUG_MODE) {
            return;
        }

        document.getElementById("form-input-country").value = COUNTRY;
        document.getElementById("form-input-location").value = LOCATION;
        document.getElementById("form-input-other-location").value = OTHER_LOCATION;
        document.getElementById("form-input-sentence").value = SENTENCE;
        document.getElementById("form-input-section2-label").value = SECTION2_LABEL;
        document.getElementById("form-input-section2-word-type").value = SECTION2_WORD_TYPE;

        // add metadata fields
        let main_form = document.querySelector("form");

        Object.keys(INPUT_METADATA).forEach(function (key) {
            let value = INPUT_METADATA[key];
            let input = document.createElement("input");
            input.type = 'hidden';
            input.id = 'form-input-metadata-' + key;
            input.name = 'metadata_' + key;
            input.value = value;

            main_form.appendChild(input);
        });

        main_form.submit();
    }

    window.onload = function () {
        render();

        // after rendering, wait 0.3 secs and open the first section
        setTimeout(function () {
            $(document.getElementById("collapse2")).collapse('show');
        }, 300)
    };

    if (!localStorage.getItem("seen-instructions")) {
        console.log("first time - showing instructions");
        localStorage.setItem("seen-instructions", "True");
        toggle('inst-collapse1');
        toggle('inst-collapse2');
    }

</script>
